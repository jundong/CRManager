<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <link rel="stylesheet" type="text/css" href="css/report.css" />
    </head>
    <body>

    </body>
    <script type="text/template" id="report-template">
        <h1>Spirent | Axon</h1>

        {{#summary}}
        <h2>Test Summary</h2>
        <div class="summary">
            <h3>Name: {{name}} | User: Admin</h3>
            <table>
                <tr>
                    <td>
                        <label>Pass/Fail/Other</label>
                        <span>{{end_result}}</span>
                    </td>
                    <td>
                        <label>Date</label>
                        <span>{{date}}</span>
                    </td>
                    <td>
                        <label>Test Id</label>
                        <span>{{test_id}}</span>
                    </td>
                    <td>
                        <label>Result Id</label>
                        <span>{{result_id}}</span>
                    </td>
                </tr>
            </table>
            <ul>
                <li><label>Categories:</label> <span>{{#categories}}{{.}},{{/categories}}</span></li>
                <li><label>Description:</label> <span>{{description}}</span></li>
            </ul>
        </div>
        {{/summary}}

        {{#configuration}}
        <h2>Configuration</h2>
        <div class="configuration">
            <h3>Test Configuration</h3>
            <table>
                <tr>
                    <td>
                        <label>Engine</label>
                        <span>{{engine}}</span>
                    </td>
                    <td>
                        <label>Duration (minutes)</label>
                        <span>{{duration}}</span>
                    </td>
                    <td>
                        <label>Is user save?</label>
                        <span>{{is_user_save}}</span>
                    </td>
                    <td>
                        <label>Module</label>
                        <span>{{module}}</span>
                    </td>
                </tr>
            </table>

            {{#tags}}
            <table>
                <caption><h5>Tags</h5></caption>
                <tbody>
                    <tr>
                        <td>
                            <label>Company</label>
                            <span>{{company}}</span>
                        </td>
                        <td>
                            <label>Favorite</label>
                            <span>{{favorite}}</span>
                        </td>
                        <td>
                            <label>Location</label>
                            <span>{{location}}</span>
                        </td>
                    </tr>
                </tbody>
            </table>

            {{#user_defined}}
            <h4>User Defined Tags</h4>
            <ul>
            {{/user_defined}}
            {{#user_defined}}
                <li>{{.}}</li>
            {{/user_defined}}
            {{#user_defined}}
            </ul>
            {{/user_defined}}
            {{/tags}}

            <h3>Traffic Player(s) Configuration</h3>
            <ul class="traffic-players">
            {{#traffic_players}}
                <li>
                    {{#.}}
                    <h4>Traffic Player Name</h4>
                    <ul>
                        {{#playlist}}
                        <li>
                            <table>
                                <caption><h5>Playlist</h5></caption>
                                <tbody>
                                    <tr>
                                        <td>
                                            <label>Name</label>
                                            <span>{{name}}</span>
                                        </td>
                                        <td>
                                            <label>Playlist Id</label>
                                            <span>{{id}}</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <h4>Tracks</h4>
                            <ul class="tracks">
                            {{#tracks}}
                                <li>
                                    <table>

                                        <tbody>
                                        <tr>
                                            <td>
                                                <label>Name</label>
                                                <span>{{name}}</span>
                                            </td>
                                            <td>
                                                <label>Track Id</label>
                                                <span>{{id}}</span>
                                            </td>
                                            <td>
                                                <label>Track Object</label>
                                                <span>{{track_object}}</span>
                                            </td>
                                            <td>
                                                <label>Percentage</label>
                                                <span>{{percentage}}</span>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>

                                    <h5>Traffic Settings</h5>
                                    <ul>
                                        {{#traffic_settings}}
                                        <li><span>{{value}} {{unit}}</span></li>
                                        {{/traffic_settings}}
                                    </ul>

                                    <h5>Track Properties</h5>
                                    <ul class="track-properties">
                                        {{#track_properties}}
                                        <li><label>{{name}}:</label> <span>{{display_value}}</span></li>
                                        {{/track_properties}}
                                    </ul>
                                </li>
                            {{/tracks}}
                            </ul>
                        </li>
                        {{/playlist}}

                        {{#source}}
                        <li>
                            <h4>Source</h4>
                            {{> device}}
                        </li>
                        {{/source}}

                        {{#destination}}
                        <li>
                            <h4>Destination</h4>
                            {{> device}}
                        </li>
                        {{/destination}}
                    </ul>
                    {{/.}}
                </li>
            {{/traffic_players}}
            </ul>
        </div>
        {{/configuration}}

        <h2>Test Data</h2>
        <div class="data">
        {{#test_data}}
            <h3>{{name}}</h3>
            <ul>
                <li><label>Status:</label> <span>{{status}}</span></li>
            </ul>

            <table>
                <caption><h5>Tracks</h5></caption>
                <tbody>
                {{#tracks}}
                {{#.}}
                <tr>
                    <td>
                        <span>{{name}}</span>
                    </td>
                    {{#cells}}
                    <td>
                        <label>{{name}}</label>
                        <span class="{{data_type}}">{{value}}</span>
                    </td>
                    {{/cells}}
                </tr>
                {{/.}}
                {{/tracks}}
                </tbody>
            </table>

        {{/test_data}}
        </div>
            <ul>
            </ul>
    </script>
    <script type="text/template" id="device-template">
            {{#device}}
            <label>Port:</label> <span>{{port}}</span>
            <table>
                <caption><h5>Device</h5></caption>
                <tbody>
                <tr>
                    <td>
                        <label>Name</label>
                        <span>{{name}}</span>
                    </td>
                    <td>
                        <label>Host</label>
                        <span>{{host}}</span>
                    </td>
                    <td>
                        <label>Id</label>
                        <span>{{id}}</span>
                    </td>
                </tr>
                </tbody>
            </table>
            {{/device}}
            {{#endpoint}}
            <table>
                <caption><h5>Endpoint</h5></caption>
                <tbody>
                <tr>
                    <td>
                        <label>Name</label>
                        <span>{{name}}</span>
                    </td>
                    <td>
                        <label>IP</label>
                        <span>{{ip}}</span>
                    </td>
                    <td>
                        <label>Prefix</label>
                        <span>{{prefix}}</span>
                    </td>
                    <td>
                        <label>End IP</label>
                        <span>{{end_ip}}</span>
                    </td>
                    <td>
                        <label>Use DHCP?</label>
                        <span>{{use_dhcp}}</span>
                    </td>
                    <td>
                        <label>Gateway</label>
                        <span>{{gateway}}</span>
                    </td>
                    <td>
                        <label>VLAN Id</label>
                        <span>{{vlan_id}}</span>
                    </td>
                </tr>
                </tbody>
            </table>
            {{/endpoint}}
    </script>
    <script src="lib/mustache.js" type="text/javascript"></script>
    <script src="lib/jquery-1.7.2.js" type="text/javascript"></script>
    <script type="text/javascript">
        function getParameterByName(name)
        {
            name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
            var regexS = "[\\?&]" + name + "=([^&#]*)";
            var regex = new RegExp(regexS);
            var results = regex.exec(window.location.search);
            if(results == null)
                return "";
            else
                return decodeURIComponent(results[1].replace(/\+/g, " "));
        }

        function functionify(functionString) {
            try {
                return (new Function('return ' + functionString + ';'))();
            } catch (exception) {
                console.log('Couldn\'t parse function. Exception: ' + exception);
            }
        }

        function isLayer7() {
            return this.layer === 7;
        }

        var template = document.getElementById('report-template').innerHTML,
            partials = {
                device: document.getElementById('device-template').innerHTML
            };

        $.ajax({
            type: 'GET',
            cache: false,
            url: 'spirent/get-report-data?result-id=' + getParameterByName('result-id'),
            dataType: 'json',
            success: function (data, textStatus, jqXhr) {
                $('body').html(Mustache.render(template, data, partials));
            },
            error: function (jqXhr, textStatus, errorThrown) {
                console.log(this, jqXhr, textStatus, errorThrown);
            }

        });
    </script>
</html>